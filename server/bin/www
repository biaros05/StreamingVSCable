import app from '../api.mjs';
import {fetchToken, fetchAllSeries} from '../data-init.mjs';

const port = 3000;
let TOKEN;
let server;
let series; /** @todo: remove this temp var */ 

try {
  TOKEN = await fetchToken();
  series = await fetchAllSeries();
  server = app.listen(port, () => {
    console.log(`Example app app listening at http://localhost:${port}`);
  });    
} catch (error) {
  console.error(`Failed to read file: ${error.message}`);
}

process.on('SIGINT', () => {
  console.debug('SIGINT signal received: closing HTTP server');
  if (server) {
    server.close(() => {
      console.debug('HTTP server closed');
    });
  }
});

export {TOKEN};